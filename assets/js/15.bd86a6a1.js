(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{664:function(s,e,n){"use strict";n.r(e);var a=n(14),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一、基本结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、基本结构"}},[s._v("#")]),s._v(" 一、基本结构")]),s._v(" "),n("blockquote",[n("p",[s._v("这个是我个人比较喜欢的结构"),n("br"),s._v("\nserver.js为主要运行文件"),n("br"),s._v("\npublic为前端打包好的文件 最终会在serverJs读取"),n("br"),s._v("\nrouters里的为对数据库的增删改 ,最终导出引入到server.js"),n("br"),s._v("\nmodels为对集合的初始化文档结构,最终导出引入到routers对集合进行操作"),n("br"),s._v(" "),n("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/12/30/16f5473ce291c60f?w=159&h=105&f=png&s=5518",alt:""}})])]),s._v(" "),n("h2",{attrs:{id:"二、基本连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、基本连接"}},[s._v("#")]),s._v(" 二、基本连接")]),s._v(" "),n("blockquote",[n("p",[s._v("首先我们连接之前 需要打开mongoDb服务,以及在终端下载Express和monngose驱动库且引入")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("//server.js\nconst mongoose = require('mongoose')\nconst express = require('express')\nconst app = express() // 产生应用对象\n//会在本地创建一个reactAntd库,默认端口号我们随mongodb27017定义\nmongoose.connect('mongodb://localhost:27017/reactAntd', {useNewUrlParser: true})\n  .then(() => {\n    console.log('连接数据库成功!!!')\n  //只有当连接上数据库后才去启动服务器\n    app.listen('5000', () => {\n      console.log('服务器启动成功, 请访问: http://localhost:5000')\n    })\n  })\n  //监听连接错误的话\n  .catch(error => {\n    console.error('连接数据库失败', error)\n  })\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("blockquote",[n("p",[s._v("然后终端运行 node server.js"),n("br"),s._v("\nuseNewUrlParser 这个mongoDB4.0之后就需要加上加上,4.0以前的可以不加"),n("br"),s._v("\n然后运行文件就会启动http://localhost:5000 当然这时候没有任何作用,仅仅表示连接服务器成功")])]),s._v(" "),n("h2",{attrs:{id:"二、对集合进行文档结构初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、对集合进行文档结构初始化"}},[s._v("#")]),s._v(" 二、对集合进行文档结构初始化")]),s._v(" "),n("blockquote",[n("p",[s._v("models>ProductModel.js 中每一个集合代表一个js文件表示不同的业务逻辑 我们就取一个来说")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 1.引入mongoose\nconst mongoose = require('mongoose')\n// 2.字义Schema(描述文档结构,用来对他接受的值进行类型校验以及初始值,以后可有ts普及起来会比较少用了)\nconst productSchema = new mongoose.Schema({\n  // type类型 required必选 default默认值\n  categoryId: {type: String, required: true}, // 定义分类的id,接收类型为字符串且必须传入\n  pCategoryId: {type: String, required: true},\n  name: {type: String, required: true}, // 名称\n  price: {type: Number, required: true}, // 价格\n  desc: {type: String},\n  status: {type: Number, default: 1}, // 定义商品状态,接收类型为数字且默认值为1\n  imgs: {type: Array, default: []}, // 定义图片列表,接收类型为数组且默认值为空数组\n  detail: {type: String}\n})\n// 3. 定义Model(与集合对应, 可以操作集合)\nconst ProductModel = mongoose.model('products', productSchema)\n// 4. 向外暴露Model  会在routes中引入\nmodule.exports = ProductModel\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("blockquote"),s._v(" "),n("h2",{attrs:{id:"三、进行对数据库的操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、进行对数据库的操作"}},[s._v("#")]),s._v(" 三、进行对数据库的操作")]),s._v(" "),n("blockquote",[n("p",[s._v("routes>index.js 我们将models的集合引入到这里 进行路由配置数据库的增删改查;"),n("br"),s._v("\n请看下列栗子,了解怎么使用即可")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const express = require('express')\nconst ProductModel = require('../models/ProductModel') //引入刚才初始化好的集合\nconst router = express.Router()// 得到路由器对象\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("blockquote",[n("p",[s._v("添加 db.create()")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("//添加产品  \nrouter.post('/manage/product/add', (req, res) => {\n  const product = req.body\n  ProductModel.create(product) //添加产品\n    .then(product => {\n      res.send({status: 0, data: product})//返回HTTP响应\n    })\n    .catch(error => {\n      console.error('添加产品异常', error)\n      res.send({status: 1, msg: '添加产品异常, 请重新尝试'}))//返回HTTP响应\n    })\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("blockquote",[n("p",[s._v("删除 db.deleteMany() 删除全部"),n("br"),s._v("\ndb.deleteOne() 删除一个")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("router.post('/manage/product/delete', (req, res) => {\n  const {userId} = req.body\n  UserModel.deleteOne({_id: userId}) //根据传入的_id 删除指定产品\n    .then((doc) => {\n      res.send({status: 0})//HTTP响应\n    })\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("blockquote",[n("p",[s._v("修改(更新)  db.update()修改数据 不返回最新改好的数据"),n("br"),s._v("\ndb.findOneAndUpdate() 修改且获取修改好的数据")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("router.post('/manage/product/update', (req, res) => {\n  const product = req.body\n  ProductModel.findOneAndUpdate({_id: product._id}, product)//获得到产品id和产品数据结构\n    .then(oldProduct => {\n      res.send({status: 0})\n    })\n    .catch(error => {\n      console.error('更新商品异常', error)\n      res.send({status: 1, msg: '更新商品名称异常, 请重新尝试'})\n    })\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("blockquote",[n("p",[s._v("查询 find()综合查询,传空获取所有"),n("br"),s._v("\nfindOne()只返回单个文档"),n("br"),s._v("\nfindById()根据Id查询返回单个文档")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("router.get('/manage/manage/list', (req, res) => {\n const {userId} = req.body\n  UserModel.findOne({_id: userId}})\n    .then(roles => {\n        res.send({status: 0, data: { roles}})\n    })\n    .catch(error => {\n      console.error('获取产品异常', error)\n      res.send({status: 1, msg: '获取产品异常, 请重新尝试'})\n    })\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("blockquote",[n("p",[s._v("最后将路由导出,在server.js引入")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("//将路由对象导出\nmodule.exports = router\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"四、完成-▽"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、完成-▽"}},[s._v("#")]),s._v(" 四、完成("),n("em",[n("sup",[s._v("▽")])]),s._v(")")]),s._v(" "),n("blockquote",[n("p",[s._v("原先我们只在server.js开启了服务器,现在我们将原先弄好的路由引入"),n("br"),s._v("\n以及读取前端打包好的文件 public")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const mongoose = require('mongoose')\nconst express = require('express')\nconst app = express() // 产生应用对象\n// 声明使用静态中间件 读取客户端的包\napp.use(express.static('public'))\n\n// 解析post的请求↓↓↓↓↓↓\napp.use(express.urlencoded({extended: true})) // 解析req.body 请求体参数是: name=tom&pwd=123\napp.use(express.json()) // 请求体参数是json结构: {name: tom, pwd: 123}\n\n// 声明使用解析cookie数据的中间件\nconst cookieParser = require('cookie-parser') \napp.use(cookieParser())\n\nconst indexRouter = require('./routers')//使用路由器中间件也就是 routers的index\napp.use('/', indexRouter)  //读取路由接口模块\n\nconst fs = require('fs')\n// 必须在路由器中间之后声明使用 ↓↓↓↓   !!!!!!!!!!!!!!!!!!!!!!!!\n//用了哈希路由就不用这个 否则使用history路由 一刷新就会出现读取js,css或者其他错误\napp.use((req, res) => {\n  fs.readFile(__dirname + '/public/index.html', (err, data)=>{\n    if(err){\n      console.log(err)\n      res.send('后台错误')\n    } else {\n      res.writeHead(200, {\n        'Content-Type': 'text/html; charset=utf-8',\n      });\n      res.end(data)\n    }\n  })\n})\n\n\n//原先的连接服务器代码 此处就忽略掉咯~~~\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("h3",{attrs:{id:"好啦-mongoose的基本使用就讲到这里-这些只是最基本的使用-还有就是可视化工具的话就用robo3t看方便哦-提前祝大家元旦快啦丫"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#好啦-mongoose的基本使用就讲到这里-这些只是最基本的使用-还有就是可视化工具的话就用robo3t看方便哦-提前祝大家元旦快啦丫"}},[s._v("#")]),s._v(" 好啦,mongoose的基本使用就讲到这里,这些只是最基本的使用,还有就是可视化工具的话就用Robo3T看方便哦,提前祝大家元旦快啦丫~~~")])])}),[],!1,null,null,null);e.default=r.exports}}]);